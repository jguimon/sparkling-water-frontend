<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Prices</title>
  <style>
    /* Basic styling for demonstration */
    .error { color: red; }
    table { width: 100%; border-collapse: collapse; }
    td, th { border: 1px solid #ddd; padding: 8px; }
  </style>
</head>
<body>
  <h1>Product Prices</h1>
  <p id="lastUpdated"></p>
  
  <!-- The table where rows will be appended -->
  <table>
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Store</th>
        <th>Cans per Pack</th>
        <th>Price per Fluid Ounce</th>
        <th>Price per Can</th>
        <th>Price per Pack</th>
      </tr>
    </thead>
    <tbody class="price-container">
      <!-- Rows will be injected here -->
      <tr><td colspan="6">Loading prices...</td></tr>
    </tbody>
  </table>

  <script>
    async function fetchPrices() {
      const container = document.querySelector(".price-container");
      const lastUpdated = document.getElementById("lastUpdated");

      try {
        // Fetch the static JSON file (make sure it's in your repository at the right location)
        const response = await fetch('/static_products.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();

        // Clear existing content
        container.innerHTML = '';

        // Display the products by creating table rows
        container.innerHTML = data.map(item => `
          <tr data-priceFluidOz="${item.price_per_fluid_ounce}" 
              data-priceCan="${item.price_per_can}" 
              data-pricePack="${item.price_per_pack}">
            <td>${item.product.name}</td>
            <td>${item.store}</td>
            <td>${item.cans_per_pack}</td>
            <td>$${item.price_per_fluid_ounce.toFixed(2)}</td>
            <td>$${item.price_per_can.toFixed(2)}</td>
            <td>$${item.price_per_pack.toFixed(2)}</td>
          </tr>
        `).join('');

        // Sorting functionality for table rows
        function sortTable(sortBy) {
          const rows = Array.from(container.querySelectorAll("tr"));
          rows.sort((a, b) => {
            const aPrice = parseFloat(a.dataset[sortBy]);
            const bPrice = parseFloat(b.dataset[sortBy]);
            return aPrice - bPrice;
          });
          container.innerHTML = "";
          rows.forEach(row => container.appendChild(row));
        }

        // Attach event listeners to radio buttons for sorting
        document.querySelectorAll('input[name="sort"]').forEach(radio => {
          radio.addEventListener("change", function() {
            sortTable(this.value);
          });
        });

        // Initial sort by "priceCan"
        sortTable("priceCan");

        // Update the last updated timestamp
        const now = new Date();
        lastUpdated.textContent = `Last updated: ${now.toLocaleString()}`;

      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = '<tr><td colspan="6" class="error">Error loading prices. Please try again later.</td></tr>';
      }
    }

    document.addEventListener('DOMContentLoaded', fetchPrices);
  </script>
</body>
</html>
